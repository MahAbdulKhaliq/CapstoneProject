@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{
    bool isSignedIn = false;
    var userId = "";

    Layout = "_Layout";

    // Code for creating a UserStats object upon page load
    @if (SignInManager.IsSignedIn(User))
    {
        isSignedIn = true;
        userId = UserManager.GetUserId(User);
    }
}


<script type="text/javascript">
    window.onload = (event) => {
        console.log("Page is loaded.");
        console.log(window.location.href);
        console.log('@isSignedIn');
        console.log('@userId');

        var jsIsSignedIn = @isSignedIn.ToString().ToLower();
        console.log(jsIsSignedIn);
        console.log(typeof jsIsSignedIn);

        if (jsIsSignedIn) {
            var url = '@Url.Action("CreateUserStats", "UserStats")';
            console.log(url);

            $.ajax({
                url: url,
                type: 'POST',
                data: { userId: '@userId', url: window.location.href }
            }).done(function () {
                console.log("Saved user stats item");
            });
        }
    };
</script>